<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Image Editor â€” WebTools</title>
    <meta name="description"
        content="Simple client-side image editor: crop, draw, erase, add border, rounded corners and export.">
    <meta name="keywords" content="image editor, crop, draw, erase, border, rounded corners, canvas, edit image">
    <link rel="icon" type="image/svg+xml" href="../../media/logo.svg">
    <link rel="stylesheet" href="../../style.css">
    <style>
        .ie-controls {
            display: flex;
            gap: .5rem;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: .75rem
        }

        .ie-canvas-wrap {
            position: relative;
            background: var(--surface-overlay);
            border-radius: 8px;
            padding: 8px
        }

        #canvas {
            max-width: 100%;
            display: block;
            background: transparent;
            position: relative;
            z-index: 1;
            width: 100%;
            height: auto;
        }

        #overlay {
            position: absolute;
            left: 8px;
            top: 8px;
            pointer-events: none;
            z-index: 2;
        }

        .tool-row {
            display: flex;
            gap: .5rem;
            align-items: center
        }

        .muted-note {
            color: var(--muted)
        }

        input,
        select,
        textarea,
        .tool-input,
        input[type="range"] {
            background: var(--surface, var(--surface-overlay));
            color: var(--text);
            border: 1px solid var(--card-border);
            padding: .35rem .5rem;
            border-radius: 6px;
        }

        input[type="color"] {
            padding: 0;
            height: 2rem;
        }

        input[type="range"] {
            accent-color: var(--accent);
        }
    </style>
</head>

<body>
    <div class="bookmark-banner">We're hard to find! <span>Press CTRL + D</span> to bookmark this tool.</div>
    <header class="site-header">
        <div class="nav-container">
            <a class="brand" href="../../"><img src="../../media/logo.svg" class="logo" alt="WebTools"><span
                    class="site-title">WebTools</span></a>
            <nav class="nav-menu"><a href="../../">Home</a><a href="../../PrivacyPolicy/">Privacy</a><a
                    href="../../TermsOfService/">Terms</a></nav>
        </div>
    </header>

    <main class="container">
        <section class="tool-ui">
            <h1>Image Editor</h1>
            <p class="muted">Upload an image, crop, draw, erase, add a border or rounded corners, undo/redo and download
                the result.</p>

            <div class="ie-controls">
                <input id="fileInput" type="file" accept="image/*">
                <div class="tool-row">
                    <label>Mode:</label>
                    <select id="mode">
                        <option value="pan">Pan/Move</option>
                        <option value="draw">Draw</option>
                        <option value="erase">Erase</option>
                        <option value="select">Select/Crop</option>
                    </select>
                </div>
                <label>Color: <input id="color" type="color" value="#ff0000"></label>
                <label>Brush: <input id="brush" type="range" min="1" max="80" value="12"></label>
                <label>Border width: <input id="borderW" type="number" min="0" value="0" style="width:5rem"></label>
                <label>Border color: <input id="borderColor" type="color" value="#000000"></label>
                <label>Radius: <input id="radius" type="range" min="0" max="200" value="0"></label>
                <button id="cropBtn" class="tool-btn">Crop</button>
                <button id="applyBorder" class="tool-btn">Apply Border</button>
                <button id="undoBtn" class="tool-btn">Undo</button>
                <button id="redoBtn" class="tool-btn">Redo</button>
                <button id="downloadBtn" class="tool-btn primary">Download PNG</button>
            </div>

            <div class="ie-canvas-wrap">
                <canvas id="canvas"></canvas>
                <canvas id="overlay"></canvas>
            </div>
            <div style="margin-top:.6rem" class="muted-note">Tip: Select "Draw" or "Erase" then drag on the image. Use
                "Select/Crop" to draw a rectangle then press Crop.</div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-left"><img src="../../media/logo.svg" class="footer-logo">
                <div class="footer-content"><span class="footer-title">WebTools &copy; 2025</span><span
                        class="footer-desc">A collection of simple, secure browser-based tools.</span></div>
            </div>
            <div class="footer-links"><a href="../../Contact/">Contact</a><a href="../../PrivacyPolicy/">Privacy
                    Policy</a><a href="../../TermsOfService/">Terms of Service</a></div>
        </div>
    </footer>

    <script>
        (function () {
            const fileInput = document.getElementById('fileInput');
            const canvas = document.getElementById('canvas');
            const overlay = document.getElementById('overlay');
            const ctx = canvas.getContext('2d');
            const ox = overlay.getContext('2d');
            const modeEl = document.getElementById('mode');
            const colorEl = document.getElementById('color');
            const brushEl = document.getElementById('brush');
            const cropBtn = document.getElementById('cropBtn');
            const borderW = document.getElementById('borderW');
            const borderColor = document.getElementById('borderColor');
            const applyBorder = document.getElementById('applyBorder');
            const radiusEl = document.getElementById('radius');
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            const downloadBtn = document.getElementById('downloadBtn');

            let image = new Image();
            let scale = 1;
            let isDrawing = false;
            let lastX = 0, lastY = 0;
            let drawMode = 'pan';
            let selection = null;
            let selecting = false;

            const history = { stack: [], pos: -1, max: 30 };
            function pushHistory() { try { const data = canvas.toDataURL(); if (history.pos < history.stack.length - 1) history.stack = history.stack.slice(0, history.pos + 1); history.stack.push(data); if (history.stack.length > history.max) history.stack.shift(); history.pos = history.stack.length - 1; } catch (e) { } }
            function undo() { if (history.pos > 0) { history.pos--; const img = new Image(); img.onload = () => { canvas.width = img.width; canvas.height = img.height; overlay.width = img.width; overlay.height = img.height; ctx.drawImage(img, 0, 0); }; img.src = history.stack[history.pos]; } }
            function redo() { if (history.pos < history.stack.length - 1) { history.pos++; const img = new Image(); img.onload = () => { canvas.width = img.width; canvas.height = img.height; overlay.width = img.width; overlay.height = img.height; ctx.drawImage(img, 0, 0); }; img.src = history.stack[history.pos]; } }

            function fitCanvas(w, h) {
                const maxW = Math.min(w, 1200);
                const ratio = maxW / w;
                const logicalW = Math.round(w * ratio);
                const logicalH = Math.round(h * ratio);
                canvas.width = logicalW;
                canvas.height = logicalH;
                canvas.style.width = logicalW + 'px';
                canvas.style.height = logicalH + 'px';
                overlay.width = logicalW;
                overlay.height = logicalH;
                overlay.style.width = logicalW + 'px';
                overlay.style.height = logicalH + 'px';
                scale = ratio;
            }

            fileInput.addEventListener('change', (e) => {
                const f = e.target.files && e.target.files[0]; if (!f) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    image = new Image();
                    image.onload = () => {
                        fitCanvas(image.naturalWidth, image.naturalHeight);
                        canvas.style.width = canvas.width + 'px';
                        canvas.style.height = canvas.height + 'px';
                        overlay.style.left = '8px';
                        overlay.style.top = '8px';
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
                        syncOverlay();
                        pushHistory();
                    };
                    image.src = ev.target.result;
                };
                reader.readAsDataURL(f);
            });

            function getPointer(e) { const r = canvas.getBoundingClientRect(); const x = (e.clientX - r.left); const y = (e.clientY - r.top); return { x: x, y: y }; }

            canvas.addEventListener('pointerdown', (e) => {
                const p = getPointer(e); lastX = p.x; lastY = p.y;
                if (modeEl.value === 'draw' || modeEl.value === 'erase') {
                    isDrawing = true; canvas.setPointerCapture(e.pointerId);
                    ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.lineWidth = parseInt(brushEl.value, 10) || 8;
                    if (modeEl.value === 'erase') { ctx.globalCompositeOperation = 'destination-out'; ctx.strokeStyle = 'rgba(0,0,0,1)'; }
                    else { ctx.globalCompositeOperation = 'source-over'; ctx.strokeStyle = colorEl.value; }
                    ctx.beginPath(); ctx.moveTo(lastX, lastY);
                } else if (modeEl.value === 'select') {
                    selecting = true; selection = { x: p.x, y: p.y, w: 0, h: 0, startX: p.x, startY: p.y }; drawOverlay();
                }
            });

            canvas.addEventListener('pointermove', (e) => {
                const p = getPointer(e);
                if (isDrawing) { ctx.lineTo(p.x, p.y); ctx.stroke(); lastX = p.x; lastY = p.y; }
                if (selecting && selection) { selection.w = p.x - selection.startX; selection.h = p.y - selection.startY; drawOverlay(); }
            });

            canvas.addEventListener('pointerup', (e) => {
                if (isDrawing) { isDrawing = false; ctx.closePath(); ctx.globalCompositeOperation = 'source-over'; pushHistory(); }
                if (selecting) { selecting = false; drawOverlay(); }
            });

            function drawOverlay() { ox.clearRect(0, 0, overlay.width, overlay.height); if (selection) { ox.strokeStyle = 'rgba(255,255,255,0.9)'; ox.lineWidth = 2; ox.setLineDash([6, 4]); ox.strokeRect(selection.x, selection.y, selection.w, selection.h); } }

            cropBtn.addEventListener('click', () => {
                if (!selection) return alert('Draw a selection first using Select/Crop');
                const sx = Math.min(selection.x, selection.x + selection.w); const sy = Math.min(selection.y, selection.y + selection.h);
                const sw = Math.abs(selection.w); const sh = Math.abs(selection.h);
                if (sw < 4 || sh < 4) return alert('Selection too small');
                const tmp = document.createElement('canvas'); tmp.width = sw; tmp.height = sh; const tctx = tmp.getContext('2d');
                tctx.drawImage(canvas, sx, sy, sw, sh, 0, 0, sw, sh);
                canvas.width = sw; canvas.height = sh; overlay.width = sw; overlay.height = sh; ctx.clearRect(0, 0, sw, sh); ctx.drawImage(tmp, 0, 0);
                selection = null; drawOverlay(); pushHistory();
            });

            applyBorder.addEventListener('click', () => {
                const bw = parseInt(borderW.value, 10) || 0; const bc = borderColor.value; if (bw <= 0) return alert('Set border width greater than 0');
                ctx.save(); ctx.strokeStyle = bc; ctx.lineWidth = bw * 2;
                const r = parseInt(radiusEl.value, 10) || 0;
                if (r > 0) { roundRect(ctx, bw, bw, canvas.width - bw * 2, canvas.height - bw * 2, r); ctx.stroke(); }
                else { ctx.strokeRect(bw, bw, canvas.width - bw * 2, canvas.height - bw * 2); }
                ctx.restore(); pushHistory();
            });

            function roundRect(ctx, x, y, w, h, r) { ctx.beginPath(); ctx.moveTo(x + r, y); ctx.arcTo(x + w, y, x + w, y + h, r); ctx.arcTo(x + w, y + h, x, y + h, r); ctx.arcTo(x, y + h, x, y, r); ctx.arcTo(x, y, x + w, y, r); ctx.closePath(); }

            undoBtn.addEventListener('click', undo);
            redoBtn.addEventListener('click', redo);

            downloadBtn.addEventListener('click', () => {
                const exp = document.createElement('canvas'); exp.width = canvas.width; exp.height = canvas.height; const ectx = exp.getContext('2d');
                const r = parseInt(radiusEl.value, 10) || 0; if (r > 0) { ectx.save(); roundRect(ectx, 0, 0, exp.width, exp.height, r); ectx.clip(); }
                ectx.drawImage(canvas, 0, 0);
                if (parseInt(borderW.value, 10) > 0) { ectx.save(); ectx.strokeStyle = borderColor.value; ectx.lineWidth = parseInt(borderW.value, 10); if (r > 0) { roundRect(ectx, ectx.lineWidth / 2, ectx.lineWidth / 2, exp.width - ectx.lineWidth, exp.height - ectx.lineWidth, r); ectx.stroke(); } else { ectx.strokeRect(ectx.lineWidth / 2, ectx.lineWidth / 2, exp.width - ectx.lineWidth, exp.height - ectx.lineWidth); } ectx.restore(); }
                const url = exp.toDataURL('image/png'); const a = document.createElement('a'); a.href = url; a.download = 'image-edit.png'; document.body.appendChild(a); a.click(); a.remove();
            });

            function syncOverlay() { const r = canvas.getBoundingClientRect(); overlay.style.width = canvas.width + 'px'; overlay.style.height = canvas.height + 'px'; overlay.width = canvas.width; overlay.height = canvas.height; }

            window.addEventListener('resize', syncOverlay);

            canvas.width = 800; canvas.height = 500; overlay.width = canvas.width; overlay.height = canvas.height; ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            pushHistory();

        })();
    </script>
</body>

</html>